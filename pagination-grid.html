<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="pagination-grid">
    <template >
        <style>
          #pages {
            display: flex;
            flex-wrap: wrap;
            margin: 20px;
          }

          #pages > button {
            user-select: none;
            padding: 5px;
            margin: 0 5px;
            border-radius: 10%;
            border: 0;
            background: transparent;
            font: inherit;
            outline: none;
            cursor: pointer;
          }

          #pages > button:not([disabled]):hover,
          #pages > button:focus {
            color: #ccc;
            background-color: #eee;
          }

          #pages > button[selected] {
            font-weight: bold;
            color: white;
            background-color: #ccc;
          }

          #pages > button[disabled] {
            opacity: 0.5;
            cursor: default;
          }
        </style>

        <div id="pages"></div>
    </template>

    <script>
        class PaginationGrid extends Polymer.Element {
            static get is() {
                return 'pagination-grid';
              }

            constructor() {
                super();
            }

            connectedCallback() {
              super.connectedCallback();
              console.log("connectedCallback llamar al update");

             Polymer.RenderStatus.afterNextRender(this, () => {
                const pagesControl = this.shadowRoot.querySelector('#pages');
                console.log("callback "+pagesControl);
               this.updateItemsFromPage(0, 5)
              });

            }

            ready() {
              super.ready();

            }


            updateItemsFromPage(currPage, pageSize) {

                let pages;
                const pagesControl = this.shadowRoot.querySelector('#pages');

               if (pageSize === undefined) {
                 return;
               }

               var miInit = { method: 'GET',
                  mode: 'no-cors'
               };

               console.log("entramos ahora al fetch");

               fetch('https://desarrollo.bbva.com.py/softoken/YaguareteBE/api/security/v1/software-tokens?orderBy=id&order=ASC&pageSize='+pageSize+'&paginationKey='+currPage)
                 .then(res => res.json())
                 .then(function(response) {
                     //console.log("response");
                     //console.log(response);
                     console.log("el curr "+currPage);

                     let datos = response.data;
                     let paginacion = response.pagination;


                     if (!pages) {

                       //pages = paginacion.totalPages;
                       const maxBtns = 5;
                       pages = Array.from([1, 2, 3], x => x);

                       const firstBtn = window.document.createElement('button');
                       firstBtn.textContent = '<<';
                       firstBtn.addEventListener('click', function() {
                         this.updateItemsFromPage(0, pageSize);
                       });
                       pagesControl.appendChild(firstBtn);

                       const prevBtn = window.document.createElement('button');
                       prevBtn.textContent = '<';
                       prevBtn.addEventListener('click', function() {
                         const selectedPage = parseInt(pagesControl.querySelector('[selected]').textContent) -1;
                         this.updateItemsFromPage(selectedPage - 1, pageSize);
                       });
                       pagesControl.appendChild(prevBtn);

                       //para todas las paginas
                       pages.forEach(function(pageNumber) {
                         const pageBtn =  document.createElement('button');
                         pageBtn.textContent = pageNumber;
                         pageBtn.addEventListener('on-click', function(e) {
                           this.updateItemsFromPage(parseInt(e.target.textContent)-1, pageSize);
                         });
                         if (pageNumber === currPage) {
                           pageBtn.setAttribute('selected', true);
                         }
                         pagesControl.appendChild(pageBtn);
                       });

                       const nextBtn = window.document.createElement('button');
                       nextBtn.textContent = '>';
                       nextBtn.addEventListener('click', function() {
                         const selectedPage = parseInt(pagesControl.querySelector('[selected]').textContent) -1;
                         this.updateItemsFromPage(selectedPage + 1, pageSize);
                       });
                       pagesControl.appendChild(nextBtn);

                       const lastBtn = window.document.createElement('button');
                       lastBtn.textContent = '>>';
                       lastBtn.addEventListener('click', function() {
                         this.updateItemsFromPage(paginacion.totalPages - 1, pageSize);
                       });
                       pagesControl.appendChild(lastBtn);
                     }



                     const buttons = Array.from(pagesControl.children);
                     buttons.forEach(function(btn, index) {
                       let paginaNormal = currPage+1;
                       if (parseInt(btn.textContent) === paginaNormal) {
                         btn.setAttribute('selected', true);
                       } else {
                         btn.removeAttribute('selected');
                       }
                       if (index === 0) {
                         if (paginaNormal === 1) {
                           btn.setAttribute('disabled', '');
                         } else {
                           btn.removeAttribute('disabled');
                         }
                       }
                       if (index === buttons.length - 1) {
                         if (paginaNormal === pages.length) {
                           btn.setAttribute('disabled', '');
                         } else {
                           btn.removeAttribute('disabled');
                         }
                       }
                     });

                     console.log("Solo imprimimos "+datos);
                     //grid.items = datos

               });

           }
        }
        customElements.define(PaginationGrid.is, PaginationGrid);
    </script>
</dom-module>

<!--

  </head>
  <body>

    <vaadin-grid theme="row-dividers" page-size="5" height-by-rows>
      <vaadin-grid-column id="idCustomer" width="9em" path="customer.customerId" header="Número Documento"></vaadin-grid-column>
      <vaadin-grid-column id="idDevice" width="9em" path="deviceIdentifier" header="ID Dispositivo"></vaadin-grid-column>
      <vaadin-grid-column id="marcaDevice" width="9em" header="Marca"></vaadin-grid-column>
      <vaadin-grid-column id="modeloDevice" width="9em" header="Modelo"></vaadin-grid-column>
      <vaadin-grid-column id="sistemaDevice" width="9em" path="device.os" header="Sistema"></vaadin-grid-column>
      <vaadin-grid-column id="sistemaVersionDevice" width="9em" path="device.osVersion" header="Sistema Versión"></vaadin-grid-column>
      <vaadin-grid-column id="aliasDevice" width="9em" path="device.alias" header="Alias"></vaadin-grid-column>
  </vaadin-grid> -->

<!--
  </body>
  <script>

      window.addEventListener('WebComponentsReady', function() {
       // Assign an array of user objects as the grid's items
      // document.querySelector('vaadin-grid').items = Vaadin.GridDemo.users;

      const grid = document.querySelector('vaadin-grid');

      let pages;







     });

</script>
</html> -->
